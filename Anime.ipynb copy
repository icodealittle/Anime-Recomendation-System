{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# MyAnimeList Data"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Data Pre-Processing "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/opt/anaconda3/envs/myenv/lib/python3.6/site-packages/fuzzywuzzy/fuzz.py:11: UserWarning: Using slow pure-python SequenceMatcher. Install python-Levenshtein to remove this warning\n",
      "  warnings.warn('Using slow pure-python SequenceMatcher. Install python-Levenshtein to remove this warning')\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import ast\n",
    "from scipy.sparse import csr_matrix\n",
    "from sklearn.neighbors import NearestNeighbors\n",
    "from fuzzywuzzy import process\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.linear_model import LinearRegression\n",
    "from sklearn.metrics import *\n",
    "from statistics import mean\n",
    "from sklearn.decomposition import PCA\n",
    "from sklearn.preprocessing import StandardScaler"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "data = './datasets/anime_data.csv'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_csv(data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>mal_id</th>\n",
       "      <th>aired_from</th>\n",
       "      <th>aired_to</th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>premiered</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>status</th>\n",
       "      <th>studios</th>\n",
       "      <th>synopsis</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>['Action', 'Adventure', 'Comedy', 'Drama', 'Sc...</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[{'mal_id': 14, 'name': 'Sunrise'}]</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>100</td>\n",
       "      <td>2001-04-04T00:00:00+00:00</td>\n",
       "      <td>2001-06-27T00:00:00+00:00</td>\n",
       "      <td>23 min per ep</td>\n",
       "      <td>13</td>\n",
       "      <td>['Comedy', 'Drama', 'Fantasy', 'Magic', 'Roman...</td>\n",
       "      <td>2075</td>\n",
       "      <td>Spring 2001</td>\n",
       "      <td>2703.0</td>\n",
       "      <td>PG-13 - Teens 13 or older</td>\n",
       "      <td>7.21</td>\n",
       "      <td>23787</td>\n",
       "      <td>Manga</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[{'mal_id': 34, 'name': 'Hal Film Maker'}]</td>\n",
       "      <td>Due to her father's remarriage, robust 16-year...</td>\n",
       "      <td>Shin Shirayuki-hime Densetsu Prétear</td>\n",
       "      <td>Prétear: The New Legend of Snow White</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1000</td>\n",
       "      <td>1978-03-14T00:00:00+00:00</td>\n",
       "      <td>1979-02-13T00:00:00+00:00</td>\n",
       "      <td>25 min per ep</td>\n",
       "      <td>42</td>\n",
       "      <td>['Action', 'Sci-Fi', 'Adventure', 'Space', 'Dr...</td>\n",
       "      <td>2980</td>\n",
       "      <td>Spring 1978</td>\n",
       "      <td>1008.0</td>\n",
       "      <td>PG-13 - Teens 13 or older</td>\n",
       "      <td>7.71</td>\n",
       "      <td>7059</td>\n",
       "      <td>Manga</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[{'mal_id': 18, 'name': 'Toei Animation'}]</td>\n",
       "      <td>It is 2977 AD and mankind has become stagnant....</td>\n",
       "      <td>Uchuu Kaizoku Captain Herlock</td>\n",
       "      <td>Space Pirate Captain Harlock</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>10003</td>\n",
       "      <td>2008-01-01T00:00:00+00:00</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2 min per ep</td>\n",
       "      <td>15</td>\n",
       "      <td>['Comedy', 'Dementia', 'Horror', 'Seinen']</td>\n",
       "      <td>6848</td>\n",
       "      <td>NaN</td>\n",
       "      <td>10146.0</td>\n",
       "      <td>R+ - Mild Nudity</td>\n",
       "      <td>5.05</td>\n",
       "      <td>1181</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[]</td>\n",
       "      <td>In these jokey short films, many of them crude...</td>\n",
       "      <td>Kago Shintarou Anime Sakuhin Shuu</td>\n",
       "      <td>NaN</td>\n",
       "      <td>OVA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>10005</td>\n",
       "      <td>2007-03-31T00:00:00+00:00</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1 hr 35 min</td>\n",
       "      <td>1</td>\n",
       "      <td>['Action', 'Adventure', 'Mecha', 'Sci-Fi']</td>\n",
       "      <td>10765</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6121.0</td>\n",
       "      <td>G - All Ages</td>\n",
       "      <td>6.43</td>\n",
       "      <td>228</td>\n",
       "      <td>Unknown</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[{'mal_id': 455, 'name': 'Palm Studio'}]</td>\n",
       "      <td>This theatrical version based on the manga by ...</td>\n",
       "      <td>Tetsujin 28-gou: Hakuchuu no Zangetsu</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Movie</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   mal_id                 aired_from                   aired_to  \\\n",
       "0       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "1     100  2001-04-04T00:00:00+00:00  2001-06-27T00:00:00+00:00   \n",
       "2    1000  1978-03-14T00:00:00+00:00  1979-02-13T00:00:00+00:00   \n",
       "3   10003  2008-01-01T00:00:00+00:00                        NaN   \n",
       "4   10005  2007-03-31T00:00:00+00:00                        NaN   \n",
       "\n",
       "        duration  episodes                                             genres  \\\n",
       "0  24 min per ep        26  ['Action', 'Adventure', 'Comedy', 'Drama', 'Sc...   \n",
       "1  23 min per ep        13  ['Comedy', 'Drama', 'Fantasy', 'Magic', 'Roman...   \n",
       "2  25 min per ep        42  ['Action', 'Sci-Fi', 'Adventure', 'Space', 'Dr...   \n",
       "3   2 min per ep        15         ['Comedy', 'Dementia', 'Horror', 'Seinen']   \n",
       "4    1 hr 35 min         1         ['Action', 'Adventure', 'Mecha', 'Sci-Fi']   \n",
       "\n",
       "   popularity    premiered     rank                          rating  score  \\\n",
       "0          38  Spring 1998     27.0  R - 17+ (violence & profanity)   8.79   \n",
       "1        2075  Spring 2001   2703.0       PG-13 - Teens 13 or older   7.21   \n",
       "2        2980  Spring 1978   1008.0       PG-13 - Teens 13 or older   7.71   \n",
       "3        6848          NaN  10146.0                R+ - Mild Nudity   5.05   \n",
       "4       10765          NaN   6121.0                    G - All Ages   6.43   \n",
       "\n",
       "   scored_by    source           status  \\\n",
       "0     544987  Original  Finished Airing   \n",
       "1      23787     Manga  Finished Airing   \n",
       "2       7059     Manga  Finished Airing   \n",
       "3       1181  Original  Finished Airing   \n",
       "4        228   Unknown  Finished Airing   \n",
       "\n",
       "                                      studios  \\\n",
       "0         [{'mal_id': 14, 'name': 'Sunrise'}]   \n",
       "1  [{'mal_id': 34, 'name': 'Hal Film Maker'}]   \n",
       "2  [{'mal_id': 18, 'name': 'Toei Animation'}]   \n",
       "3                                          []   \n",
       "4    [{'mal_id': 455, 'name': 'Palm Studio'}]   \n",
       "\n",
       "                                            synopsis  \\\n",
       "0  In the year 2071, humanity has colonized sever...   \n",
       "1  Due to her father's remarriage, robust 16-year...   \n",
       "2  It is 2977 AD and mankind has become stagnant....   \n",
       "3  In these jokey short films, many of them crude...   \n",
       "4  This theatrical version based on the manga by ...   \n",
       "\n",
       "                                   title  \\\n",
       "0                           Cowboy Bebop   \n",
       "1   Shin Shirayuki-hime Densetsu Prétear   \n",
       "2          Uchuu Kaizoku Captain Herlock   \n",
       "3      Kago Shintarou Anime Sakuhin Shuu   \n",
       "4  Tetsujin 28-gou: Hakuchuu no Zangetsu   \n",
       "\n",
       "                           title_english   type  \n",
       "0                           Cowboy Bebop     TV  \n",
       "1  Prétear: The New Legend of Snow White     TV  \n",
       "2           Space Pirate Captain Harlock     TV  \n",
       "3                                    NaN    OVA  \n",
       "4                                    NaN  Movie  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Extracting studio sequences into a new columns"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Source: https://stackoverflow.com/questions/71432733/pandas-extracting-a-phrase-in-a-dict-column?noredirect=1#comment126259925_71432733"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In case of the items in the column is just string, convert the column into actual object"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "df['studios'] = df['studios'].apply(ast.literal_eval)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Implementing .str to access indexes/keys from the lists/dicts of items in a column, and use a combination of pipe and where to fallback to the original values where the result from .str to returns NaN"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>mal_id</th>\n",
       "      <th>aired_from</th>\n",
       "      <th>aired_to</th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>premiered</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>status</th>\n",
       "      <th>studios</th>\n",
       "      <th>synopsis</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>['Action', 'Adventure', 'Comedy', 'Drama', 'Sc...</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>100</td>\n",
       "      <td>2001-04-04T00:00:00+00:00</td>\n",
       "      <td>2001-06-27T00:00:00+00:00</td>\n",
       "      <td>23 min per ep</td>\n",
       "      <td>13</td>\n",
       "      <td>['Comedy', 'Drama', 'Fantasy', 'Magic', 'Roman...</td>\n",
       "      <td>2075</td>\n",
       "      <td>Spring 2001</td>\n",
       "      <td>2703.0</td>\n",
       "      <td>PG-13 - Teens 13 or older</td>\n",
       "      <td>7.21</td>\n",
       "      <td>23787</td>\n",
       "      <td>Manga</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Hal Film Maker</td>\n",
       "      <td>Due to her father's remarriage, robust 16-year...</td>\n",
       "      <td>Shin Shirayuki-hime Densetsu Prétear</td>\n",
       "      <td>Prétear: The New Legend of Snow White</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1000</td>\n",
       "      <td>1978-03-14T00:00:00+00:00</td>\n",
       "      <td>1979-02-13T00:00:00+00:00</td>\n",
       "      <td>25 min per ep</td>\n",
       "      <td>42</td>\n",
       "      <td>['Action', 'Sci-Fi', 'Adventure', 'Space', 'Dr...</td>\n",
       "      <td>2980</td>\n",
       "      <td>Spring 1978</td>\n",
       "      <td>1008.0</td>\n",
       "      <td>PG-13 - Teens 13 or older</td>\n",
       "      <td>7.71</td>\n",
       "      <td>7059</td>\n",
       "      <td>Manga</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Toei Animation</td>\n",
       "      <td>It is 2977 AD and mankind has become stagnant....</td>\n",
       "      <td>Uchuu Kaizoku Captain Herlock</td>\n",
       "      <td>Space Pirate Captain Harlock</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>10003</td>\n",
       "      <td>2008-01-01T00:00:00+00:00</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2 min per ep</td>\n",
       "      <td>15</td>\n",
       "      <td>['Comedy', 'Dementia', 'Horror', 'Seinen']</td>\n",
       "      <td>6848</td>\n",
       "      <td>NaN</td>\n",
       "      <td>10146.0</td>\n",
       "      <td>R+ - Mild Nudity</td>\n",
       "      <td>5.05</td>\n",
       "      <td>1181</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>[]</td>\n",
       "      <td>In these jokey short films, many of them crude...</td>\n",
       "      <td>Kago Shintarou Anime Sakuhin Shuu</td>\n",
       "      <td>NaN</td>\n",
       "      <td>OVA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>10005</td>\n",
       "      <td>2007-03-31T00:00:00+00:00</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1 hr 35 min</td>\n",
       "      <td>1</td>\n",
       "      <td>['Action', 'Adventure', 'Mecha', 'Sci-Fi']</td>\n",
       "      <td>10765</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6121.0</td>\n",
       "      <td>G - All Ages</td>\n",
       "      <td>6.43</td>\n",
       "      <td>228</td>\n",
       "      <td>Unknown</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Palm Studio</td>\n",
       "      <td>This theatrical version based on the manga by ...</td>\n",
       "      <td>Tetsujin 28-gou: Hakuchuu no Zangetsu</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Movie</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   mal_id                 aired_from                   aired_to  \\\n",
       "0       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "1     100  2001-04-04T00:00:00+00:00  2001-06-27T00:00:00+00:00   \n",
       "2    1000  1978-03-14T00:00:00+00:00  1979-02-13T00:00:00+00:00   \n",
       "3   10003  2008-01-01T00:00:00+00:00                        NaN   \n",
       "4   10005  2007-03-31T00:00:00+00:00                        NaN   \n",
       "\n",
       "        duration  episodes                                             genres  \\\n",
       "0  24 min per ep        26  ['Action', 'Adventure', 'Comedy', 'Drama', 'Sc...   \n",
       "1  23 min per ep        13  ['Comedy', 'Drama', 'Fantasy', 'Magic', 'Roman...   \n",
       "2  25 min per ep        42  ['Action', 'Sci-Fi', 'Adventure', 'Space', 'Dr...   \n",
       "3   2 min per ep        15         ['Comedy', 'Dementia', 'Horror', 'Seinen']   \n",
       "4    1 hr 35 min         1         ['Action', 'Adventure', 'Mecha', 'Sci-Fi']   \n",
       "\n",
       "   popularity    premiered     rank                          rating  score  \\\n",
       "0          38  Spring 1998     27.0  R - 17+ (violence & profanity)   8.79   \n",
       "1        2075  Spring 2001   2703.0       PG-13 - Teens 13 or older   7.21   \n",
       "2        2980  Spring 1978   1008.0       PG-13 - Teens 13 or older   7.71   \n",
       "3        6848          NaN  10146.0                R+ - Mild Nudity   5.05   \n",
       "4       10765          NaN   6121.0                    G - All Ages   6.43   \n",
       "\n",
       "   scored_by    source           status         studios  \\\n",
       "0     544987  Original  Finished Airing         Sunrise   \n",
       "1      23787     Manga  Finished Airing  Hal Film Maker   \n",
       "2       7059     Manga  Finished Airing  Toei Animation   \n",
       "3       1181  Original  Finished Airing              []   \n",
       "4        228   Unknown  Finished Airing     Palm Studio   \n",
       "\n",
       "                                            synopsis  \\\n",
       "0  In the year 2071, humanity has colonized sever...   \n",
       "1  Due to her father's remarriage, robust 16-year...   \n",
       "2  It is 2977 AD and mankind has become stagnant....   \n",
       "3  In these jokey short films, many of them crude...   \n",
       "4  This theatrical version based on the manga by ...   \n",
       "\n",
       "                                   title  \\\n",
       "0                           Cowboy Bebop   \n",
       "1   Shin Shirayuki-hime Densetsu Prétear   \n",
       "2          Uchuu Kaizoku Captain Herlock   \n",
       "3      Kago Shintarou Anime Sakuhin Shuu   \n",
       "4  Tetsujin 28-gou: Hakuchuu no Zangetsu   \n",
       "\n",
       "                           title_english   type  \n",
       "0                           Cowboy Bebop     TV  \n",
       "1  Prétear: The New Legend of Snow White     TV  \n",
       "2           Space Pirate Captain Harlock     TV  \n",
       "3                                    NaN    OVA  \n",
       "4                                    NaN  Movie  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df['studios'] = df['studios'].str[0].str['name'].pipe(lambda x: x.where(x.notna(), df['studios']))\n",
    "df.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Extract genre list into an individual row"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0    ['Action', 'Adventure', 'Comedy', 'Drama', 'Sc...\n",
       "1    ['Comedy', 'Drama', 'Fantasy', 'Magic', 'Roman...\n",
       "2    ['Action', 'Sci-Fi', 'Adventure', 'Space', 'Dr...\n",
       "3           ['Comedy', 'Dementia', 'Horror', 'Seinen']\n",
       "4           ['Action', 'Adventure', 'Mecha', 'Sci-Fi']\n",
       "Name: genres, dtype: object"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df['genres'].head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**Convert the values in the genres column to actual list, because it might just look like a list but actually be a string.**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "df['genres'] = df['genres'].apply(ast.literal_eval)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**Implementing .explode() for genres column**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "data = df.explode('genres').reset_index(drop = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>mal_id</th>\n",
       "      <th>aired_from</th>\n",
       "      <th>aired_to</th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>premiered</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>status</th>\n",
       "      <th>studios</th>\n",
       "      <th>synopsis</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Drama</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Sci-Fi</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   mal_id                 aired_from                   aired_to  \\\n",
       "0       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "1       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "2       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "3       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "4       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "\n",
       "        duration  episodes     genres  popularity    premiered  rank  \\\n",
       "0  24 min per ep        26     Action          38  Spring 1998  27.0   \n",
       "1  24 min per ep        26  Adventure          38  Spring 1998  27.0   \n",
       "2  24 min per ep        26     Comedy          38  Spring 1998  27.0   \n",
       "3  24 min per ep        26      Drama          38  Spring 1998  27.0   \n",
       "4  24 min per ep        26     Sci-Fi          38  Spring 1998  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original   \n",
       "2  R - 17+ (violence & profanity)   8.79     544987  Original   \n",
       "3  R - 17+ (violence & profanity)   8.79     544987  Original   \n",
       "4  R - 17+ (violence & profanity)   8.79     544987  Original   \n",
       "\n",
       "            status  studios  \\\n",
       "0  Finished Airing  Sunrise   \n",
       "1  Finished Airing  Sunrise   \n",
       "2  Finished Airing  Sunrise   \n",
       "3  Finished Airing  Sunrise   \n",
       "4  Finished Airing  Sunrise   \n",
       "\n",
       "                                            synopsis         title  \\\n",
       "0  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "1  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "2  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "3  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "4  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "\n",
       "  title_english type  \n",
       "0  Cowboy Bebop   TV  \n",
       "1  Cowboy Bebop   TV  \n",
       "2  Cowboy Bebop   TV  \n",
       "3  Cowboy Bebop   TV  \n",
       "4  Cowboy Bebop   TV  "
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Data Information + Rows and Columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 35984 entries, 0 to 35983\n",
      "Data columns (total 19 columns):\n",
      " #   Column         Non-Null Count  Dtype  \n",
      "---  ------         --------------  -----  \n",
      " 0   mal_id         35984 non-null  int64  \n",
      " 1   aired_from     35977 non-null  object \n",
      " 2   aired_to       20657 non-null  object \n",
      " 3   duration       35984 non-null  object \n",
      " 4   episodes       35984 non-null  int64  \n",
      " 5   genres         35969 non-null  object \n",
      " 6   popularity     35984 non-null  int64  \n",
      " 7   premiered      13621 non-null  object \n",
      " 8   rank           33954 non-null  float64\n",
      " 9   rating         35984 non-null  object \n",
      " 10  score          35984 non-null  float64\n",
      " 11  scored_by      35984 non-null  int64  \n",
      " 12  source         35984 non-null  object \n",
      " 13  status         35984 non-null  object \n",
      " 14  studios        35984 non-null  object \n",
      " 15  synopsis       35465 non-null  object \n",
      " 16  title          35984 non-null  object \n",
      " 17  title_english  19120 non-null  object \n",
      " 18  type           35984 non-null  object \n",
      "dtypes: float64(2), int64(4), object(13)\n",
      "memory usage: 5.2+ MB\n"
     ]
    }
   ],
   "source": [
    "data.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(35984, 19)"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Looking for missing value within the dataset"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "mal_id               0\n",
       "aired_from           7\n",
       "aired_to         15327\n",
       "duration             0\n",
       "episodes             0\n",
       "genres              15\n",
       "popularity           0\n",
       "premiered        22363\n",
       "rank              2030\n",
       "rating               0\n",
       "score                0\n",
       "scored_by            0\n",
       "source               0\n",
       "status               0\n",
       "studios              0\n",
       "synopsis           519\n",
       "title                0\n",
       "title_english    16864\n",
       "type                 0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.isnull().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Extracting Season and Year from primier column to create two new columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "data[['premiered_season', 'premiered_year']] = data['premiered'].str.split(expand = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>mal_id</th>\n",
       "      <th>aired_from</th>\n",
       "      <th>aired_to</th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>premiered</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>...</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>status</th>\n",
       "      <th>studios</th>\n",
       "      <th>synopsis</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>...</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>...</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>...</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Drama</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>...</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>1998-04-03T00:00:00+00:00</td>\n",
       "      <td>1999-04-24T00:00:00+00:00</td>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Sci-Fi</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>...</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Finished Airing</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>In the year 2071, humanity has colonized sever...</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 21 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   mal_id                 aired_from                   aired_to  \\\n",
       "0       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "1       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "2       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "3       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "4       1  1998-04-03T00:00:00+00:00  1999-04-24T00:00:00+00:00   \n",
       "\n",
       "        duration  episodes     genres  popularity    premiered  rank  \\\n",
       "0  24 min per ep        26     Action          38  Spring 1998  27.0   \n",
       "1  24 min per ep        26  Adventure          38  Spring 1998  27.0   \n",
       "2  24 min per ep        26     Comedy          38  Spring 1998  27.0   \n",
       "3  24 min per ep        26      Drama          38  Spring 1998  27.0   \n",
       "4  24 min per ep        26     Sci-Fi          38  Spring 1998  27.0   \n",
       "\n",
       "                           rating  ...  scored_by    source           status  \\\n",
       "0  R - 17+ (violence & profanity)  ...     544987  Original  Finished Airing   \n",
       "1  R - 17+ (violence & profanity)  ...     544987  Original  Finished Airing   \n",
       "2  R - 17+ (violence & profanity)  ...     544987  Original  Finished Airing   \n",
       "3  R - 17+ (violence & profanity)  ...     544987  Original  Finished Airing   \n",
       "4  R - 17+ (violence & profanity)  ...     544987  Original  Finished Airing   \n",
       "\n",
       "   studios                                           synopsis         title  \\\n",
       "0  Sunrise  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "1  Sunrise  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "2  Sunrise  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "3  Sunrise  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "4  Sunrise  In the year 2071, humanity has colonized sever...  Cowboy Bebop   \n",
       "\n",
       "  title_english type premiered_season premiered_year  \n",
       "0  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop   TV           Spring           1998  \n",
       "2  Cowboy Bebop   TV           Spring           1998  \n",
       "3  Cowboy Bebop   TV           Spring           1998  \n",
       "4  Cowboy Bebop   TV           Spring           1998  \n",
       "\n",
       "[5 rows x 21 columns]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['mal_id', 'aired_from', 'aired_to', 'duration', 'episodes', 'genres',\n",
       "       'popularity', 'premiered', 'rank', 'rating', 'score', 'scored_by',\n",
       "       'source', 'status', 'studios', 'synopsis', 'title', 'title_english',\n",
       "       'type', 'premiered_season', 'premiered_year'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.columns"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Dropping Columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "data.drop(['mal_id', 'aired_from', 'aired_to', 'synopsis', 'status'], axis = 1, inplace = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>premiered</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>studios</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Drama</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Sci-Fi</td>\n",
       "      <td>38</td>\n",
       "      <td>Spring 1998</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        duration  episodes     genres  popularity    premiered  rank  \\\n",
       "0  24 min per ep        26     Action          38  Spring 1998  27.0   \n",
       "1  24 min per ep        26  Adventure          38  Spring 1998  27.0   \n",
       "2  24 min per ep        26     Comedy          38  Spring 1998  27.0   \n",
       "3  24 min per ep        26      Drama          38  Spring 1998  27.0   \n",
       "4  24 min per ep        26     Sci-Fi          38  Spring 1998  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  studios  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "2  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "3  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "4  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "\n",
       "          title title_english type premiered_season premiered_year  \n",
       "0  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "2  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "3  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "4  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  "
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Drop primiered column"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "data.drop(['premiered'], axis = 1, inplace = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>studios</th>\n",
       "      <th>title</th>\n",
       "      <th>title_english</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Drama</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Sci-Fi</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        duration  episodes     genres  popularity  rank  \\\n",
       "0  24 min per ep        26     Action          38  27.0   \n",
       "1  24 min per ep        26  Adventure          38  27.0   \n",
       "2  24 min per ep        26     Comedy          38  27.0   \n",
       "3  24 min per ep        26      Drama          38  27.0   \n",
       "4  24 min per ep        26     Sci-Fi          38  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  studios  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "2  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "3  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "4  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "\n",
       "          title title_english type premiered_season premiered_year  \n",
       "0  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "2  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "3  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  \n",
       "4  Cowboy Bebop  Cowboy Bebop   TV           Spring           1998  "
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Drop English title column"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "data.drop(['title_english'], axis = 1, inplace = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>studios</th>\n",
       "      <th>title</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Drama</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Sci-Fi</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        duration  episodes     genres  popularity  rank  \\\n",
       "0  24 min per ep        26     Action          38  27.0   \n",
       "1  24 min per ep        26  Adventure          38  27.0   \n",
       "2  24 min per ep        26     Comedy          38  27.0   \n",
       "3  24 min per ep        26      Drama          38  27.0   \n",
       "4  24 min per ep        26     Sci-Fi          38  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  studios  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "2  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "3  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "4  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "\n",
       "          title type premiered_season premiered_year  \n",
       "0  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop   TV           Spring           1998  \n",
       "2  Cowboy Bebop   TV           Spring           1998  \n",
       "3  Cowboy Bebop   TV           Spring           1998  \n",
       "4  Cowboy Bebop   TV           Spring           1998  "
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Fill NaN with 0 or make the empty column as string"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "duration            0\n",
       "episodes            0\n",
       "genres              0\n",
       "popularity          0\n",
       "rank                0\n",
       "rating              0\n",
       "score               0\n",
       "scored_by           0\n",
       "source              0\n",
       "studios             0\n",
       "title               0\n",
       "type                0\n",
       "premiered_season    0\n",
       "premiered_year      0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data['rank'] = data['rank'].fillna(data['rank'].dropna().mode().values[0])\n",
    "data['premiered_year'] = data['premiered_year'].fillna(data['premiered_year'].dropna().mode().values[0])\n",
    "data['genres'].fillna('', inplace = True)\n",
    "data['premiered_season'].fillna('', inplace = True)\n",
    "data.isnull().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>studios</th>\n",
       "      <th>title</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Comedy</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        duration  episodes     genres  popularity  rank  \\\n",
       "0  24 min per ep        26     Action          38  27.0   \n",
       "1  24 min per ep        26  Adventure          38  27.0   \n",
       "2  24 min per ep        26     Comedy          38  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  studios  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "2  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "\n",
       "          title type premiered_season premiered_year  \n",
       "0  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop   TV           Spring           1998  \n",
       "2  Cowboy Bebop   TV           Spring           1998  "
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(3)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Preprocess User Datat ###"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Following are the code used to preprocess the user_score_data.csv which is originally derived from user_data.csv. This section was commented out and data was exported into a csv since it takes a while to execute."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "# user_df = pd.read_csv('./datasets/user_data.csv')\n",
    "# user_df.insert(0, 'user_id', range(1, 1 + len(user_df)))\n",
    "# user_watched = user_df[['user_id', 'watched']]\n",
    "\n",
    "# import ast\n",
    "# user_data = []\n",
    "\n",
    "# for i in range(len(user_df)):\n",
    "#     row = user_watched.iloc[i].watched\n",
    "#     row = row.strip('][').split('}, ')\n",
    "#     for item in row:\n",
    "#         row_dict = {}\n",
    "#         if (item[-1] != \"}\"):\n",
    "#             item = item + \"}\"\n",
    "#         item_dict = ast.literal_eval(item)\n",
    "#         row_dict['user_id'] = user_watched.iloc[i].user_id\n",
    "#         row_dict['mal_id'] = item_dict['mal_id']\n",
    "#         row_dict['rating'] = item_dict['score']\n",
    "#         user_data.append(row_dict)\n",
    "\n",
    "# df_user_data = pd.DataFrame(user_data)\n",
    "# df_user_data.to_csv('user_score_data')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Linear Regression ###"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "user_data_df = pd.read_csv('./datasets/user_score_data.csv', usecols=['user_id', 'mal_id', 'rating'], dtype={'user_id':'int32', 'mal_id':'int32', 'rating':'float32'})\n",
    "animes_df = pd.read_csv('./datasets/anime_data.csv', usecols=['mal_id', 'title'], dtype={'mal_id':'int32', 'title':'string'})"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Not all users will rate every anime. Therefore, there are missing data in the ratings of animes. To have a better prediction, linear regression can be used to generate predictions of missing data based on existing values."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [],
   "source": [
    "def getOverallUserAvgAnimeRating(user_data_df):\n",
    "    average = user_data_df.groupby('mal_id')['rating'].agg('mean')\n",
    "    return pd.DataFrame({'mal_id':average.index, 'rating':average.values})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [],
   "source": [
    "def getTestTrainData(y):\n",
    "    test_data = y[y['rating_y'].isna()]\n",
    "    train_data = y.dropna(subset=['rating_y'])\n",
    "\n",
    "    y_train = train_data['rating_y']\n",
    "    X_train = train_data.drop('rating_y', axis=1)\n",
    "    \n",
    "    return test_data, train_data, y_train, X_train"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "def fillMissingRatingDataLinReg(y):\n",
    "    test_data, train_data, y_train, X_train = getTestTrainData(y)\n",
    "    lin_model = LinearRegression().fit(X_train, y_train)\n",
    "    \n",
    "    X_test = test_data.drop('rating_y', axis=1)\n",
    "    y_pred = lin_model.predict(X_test)\n",
    "    \n",
    "    test_data.loc[test_data.rating_y.isna(), 'rating_y'] = y_pred\n",
    "    \n",
    "    new = pd.concat([test_data, train_data], axis=0).sort_values(by=['mal_id'], ascending=True)\n",
    "    new.rename(columns={'rating_y':'rating'}, inplace=True)\n",
    "    \n",
    "    return new"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [],
   "source": [
    "def getComprehensiveUserRating(user_data_df, user_id):\n",
    "    '''\n",
    "        Takes user data and fills missing data based on linear regression\n",
    "        using collaborative average anime rating. Predicts what user of specified\n",
    "        id will rate each anime.\n",
    "    '''\n",
    "    # get average anime rating\n",
    "    avg_df = getOverallUserAvgAnimeRating(user_data_df)\n",
    "    \n",
    "    # get all user rating\n",
    "    y = (user_data_df[user_data_df['user_id'] == user_id])\n",
    "    y = y.drop(columns=['user_id'])\n",
    "    \n",
    "    merged_y = pd.merge(avg_df, y, on='mal_id',how='left').drop(columns=['rating_x'])\n",
    "    \n",
    "    comprehensive_df = fillMissingRatingDataLinReg(merged_y)\n",
    "    \n",
    "    return comprehensive_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "# new = getComprehensiveUserRating(user_data_df, 1)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### K-Nearest Neighbors ###"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "K-nearest neighbors can be used to generate recommendation based on specified anime. Using collaborative filtering, k-nearest neighbors will search for what other animes were enjoyed by other users who also enjoyed watching the specified anime."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: fuzzywuzzy in /opt/anaconda3/envs/myenv/lib/python3.6/site-packages (0.18.0)\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install fuzzywuzzy"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [],
   "source": [
    "animes_users = user_data_df.pivot(index='mal_id', columns='user_id', values='rating').fillna(0)\n",
    "animes_users_mat = csr_matrix(animes_users.values)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "NearestNeighbors(algorithm='brute', metric='cosine', n_neighbors=20)"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model_knn = NearestNeighbors(metric='cosine', algorithm='brute', n_neighbors=20)\n",
    "model_knn.fit(animes_users_mat)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "def getRecommendations(movie_title, data_matrix, animes_df, model_knn, n_recommendations):\n",
    "    model_knn.fit(data_matrix)\n",
    "    anime_index = process.extractOne(movie_title, animes_df['title'])[2]\n",
    "    distances, indices = model_knn.kneighbors(data_matrix[anime_index], n_neighbors=n_recommendations)\n",
    "    for i in indices:\n",
    "        print(animes_df['title'][i].where(i != anime_index))\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "3990                                                 <NA>\n",
      "6198    Iizuka-senpai x Blazer: Ane Kyun! yori The Ani...\n",
      "5435                              Kanashimi no Belladonna\n",
      "3093    New Mobile Report Gundam Wing: Frozen Teardrop...\n",
      "3295                                       Plastic Little\n",
      "Name: title, dtype: string\n"
     ]
    }
   ],
   "source": [
    "getRecommendations('Bleach', animes_users_mat, animes_df, model_knn, 5)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### PCA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>duration</th>\n",
       "      <th>episodes</th>\n",
       "      <th>genres</th>\n",
       "      <th>popularity</th>\n",
       "      <th>rank</th>\n",
       "      <th>rating</th>\n",
       "      <th>score</th>\n",
       "      <th>scored_by</th>\n",
       "      <th>source</th>\n",
       "      <th>studios</th>\n",
       "      <th>title</th>\n",
       "      <th>type</th>\n",
       "      <th>premiered_season</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Action</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>24 min per ep</td>\n",
       "      <td>26</td>\n",
       "      <td>Adventure</td>\n",
       "      <td>38</td>\n",
       "      <td>27.0</td>\n",
       "      <td>R - 17+ (violence &amp; profanity)</td>\n",
       "      <td>8.79</td>\n",
       "      <td>544987</td>\n",
       "      <td>Original</td>\n",
       "      <td>Sunrise</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "      <td>TV</td>\n",
       "      <td>Spring</td>\n",
       "      <td>1998</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        duration  episodes     genres  popularity  rank  \\\n",
       "0  24 min per ep        26     Action          38  27.0   \n",
       "1  24 min per ep        26  Adventure          38  27.0   \n",
       "\n",
       "                           rating  score  scored_by    source  studios  \\\n",
       "0  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "1  R - 17+ (violence & profanity)   8.79     544987  Original  Sunrise   \n",
       "\n",
       "          title type premiered_season premiered_year  \n",
       "0  Cowboy Bebop   TV           Spring           1998  \n",
       "1  Cowboy Bebop   TV           Spring           1998  "
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head(2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [],
   "source": [
    "features = ['episodes', 'popularity', 'rank', 'score', 'premiered_year']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [],
   "source": [
    "X = data.loc[:, features].values\n",
    "y = data.loc[:, ['title']].values"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "X = StandardScaler().fit_transform(X)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>episodes</th>\n",
       "      <th>popularity</th>\n",
       "      <th>rank</th>\n",
       "      <th>score</th>\n",
       "      <th>premiered_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0.335596</td>\n",
       "      <td>-1.449592</td>\n",
       "      <td>-1.527175</td>\n",
       "      <td>2.375764</td>\n",
       "      <td>-1.764233</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.335596</td>\n",
       "      <td>-1.449592</td>\n",
       "      <td>-1.527175</td>\n",
       "      <td>2.375764</td>\n",
       "      <td>-1.764233</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.335596</td>\n",
       "      <td>-1.449592</td>\n",
       "      <td>-1.527175</td>\n",
       "      <td>2.375764</td>\n",
       "      <td>-1.764233</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   episodes  popularity      rank     score  premiered_year\n",
       "0  0.335596   -1.449592 -1.527175  2.375764       -1.764233\n",
       "1  0.335596   -1.449592 -1.527175  2.375764       -1.764233\n",
       "2  0.335596   -1.449592 -1.527175  2.375764       -1.764233"
      ]
     },
     "execution_count": 41,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pca_df = pd.DataFrame(data = X, columns = features).head()\n",
    "pca_df.head(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "projection_pca = PCA(n_components = 5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [],
   "source": [
    "components = projection_pca.fit_transform(X)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [],
   "source": [
    "two_d = df2 = pd.DataFrame(components, columns = ['Component 1', 'Component 2', 'Component 3', 'Component 4', 'Component 5'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Component 1</th>\n",
       "      <th>Component 2</th>\n",
       "      <th>Component 3</th>\n",
       "      <th>Component 4</th>\n",
       "      <th>Component 5</th>\n",
       "      <th>title</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>3.305986</td>\n",
       "      <td>0.967371</td>\n",
       "      <td>-1.057385</td>\n",
       "      <td>-0.067117</td>\n",
       "      <td>-0.561301</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3.305986</td>\n",
       "      <td>0.967371</td>\n",
       "      <td>-1.057385</td>\n",
       "      <td>-0.067117</td>\n",
       "      <td>-0.561301</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3.305986</td>\n",
       "      <td>0.967371</td>\n",
       "      <td>-1.057385</td>\n",
       "      <td>-0.067117</td>\n",
       "      <td>-0.561301</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3.305986</td>\n",
       "      <td>0.967371</td>\n",
       "      <td>-1.057385</td>\n",
       "      <td>-0.067117</td>\n",
       "      <td>-0.561301</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3.305986</td>\n",
       "      <td>0.967371</td>\n",
       "      <td>-1.057385</td>\n",
       "      <td>-0.067117</td>\n",
       "      <td>-0.561301</td>\n",
       "      <td>Cowboy Bebop</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Component 1  Component 2  Component 3  Component 4  Component 5  \\\n",
       "0     3.305986     0.967371    -1.057385    -0.067117    -0.561301   \n",
       "1     3.305986     0.967371    -1.057385    -0.067117    -0.561301   \n",
       "2     3.305986     0.967371    -1.057385    -0.067117    -0.561301   \n",
       "3     3.305986     0.967371    -1.057385    -0.067117    -0.561301   \n",
       "4     3.305986     0.967371    -1.057385    -0.067117    -0.561301   \n",
       "\n",
       "          title  \n",
       "0  Cowboy Bebop  \n",
       "1  Cowboy Bebop  \n",
       "2  Cowboy Bebop  \n",
       "3  Cowboy Bebop  \n",
       "4  Cowboy Bebop  "
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "final_df = pd.concat([two_d, data[['title']]], axis = 1) \n",
    "final_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0                        Cowboy Bebop\n",
       "1                        Cowboy Bebop\n",
       "2                        Cowboy Bebop\n",
       "3                        Cowboy Bebop\n",
       "4                        Cowboy Bebop\n",
       "                     ...             \n",
       "35979    One Piece 3D: Mugiwara Chase\n",
       "35980    One Piece 3D: Mugiwara Chase\n",
       "35981    One Piece 3D: Mugiwara Chase\n",
       "35982    One Piece 3D: Mugiwara Chase\n",
       "35983    One Piece 3D: Mugiwara Chase\n",
       "Name: title, Length: 35984, dtype: object"
      ]
     },
     "execution_count": 46,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data['title']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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wPpjxozhscceY9CgQWtcuyQpf1r3lvbrr3+2hV3bokUwe3aDV3HGGWdw1VVXsahoPd/5znc47bTTmDlzJn/4wx9WukSn+I427dq1o6roR0Vdl/J4z3NJErT20O7TB+q67VvnzrDddg1exRe+8AWOPPJIrrrqqpppH3/8MZtvvjkA1157bZ3v7d27NzNmzKCqqoq33nqLp59+umZe+/btWb58OQAjR47klltuYfHixSxatIibb76ZESNGNLh2SVK+tO7QPuooaFPHR2zTJpvfCM4888yVziI///zzOeKIIxgxYgQbb7xxne/bY4892HrrrenXrx9nnXUWgwcPrpk3btw4+vfvz7HHHsvgwYMZO3Ysw4YNY9ddd+Wb3/ymu8YlqS733gtdu2b/z3ftmr1uJWJt3/U6dOjQVPt+2rNmzWLHHXcsbwFTpmQnnVVVZbvEO3fO/iLvugv23LMJKi5tXR5+szHZj6v5/S/Bexg3Dvux4ZqkDwcPhlIn6g4aBNOnN+66mkhETEspDS01r3WfiAZZML/zTnbS2ezZ2S7xo46CLl1aujJJUmO6997SgQ3Z9IcegtGjm7emRtb6QxuygG7AWeKSpBw4/PD65x9ySKMMrtWSWvcxbUnSuqOuq4XKnZ8DhrYkqXWo62qhcufngKEtSWodbryx/vm33to8dTQhQ1uS1Drst192lngpgwbl/iQ0aKHQjoi2EfFcRNzREutvDHPnzuWQQw6hT58+bLvttpx++ul8+umnjbLssWPHsvXWWzNw4EAGDx7M1KlTATjwwANZsGBBo6yjtjfeeIMhQ4YwcOBAdt55Zy6//PKaeaNGjWKHHXagf//+fOlLX+K0004rq46xY8fSqVMnKopO/Dj99NOJiDW+O9r06dP57ne/u0bvbajly5fzwx/+kD59+tC3b1+GDRvG3XffDUAXr0aQ1g7Tp8ODD2YnIEdkzw8+mJvLvValpba0TwdmNdfKKisreOedP/KPf5zNO+/8kcrKhp09mFJizJgxHHroobz++uu89tprLFy4kB/96EeNVDFccsklzJgxg4suuohTTjkFgLvuuovu3bs32jqKbbrppjzxxBPMmDGDp556iosuuoh33nmnZv7EiRN54YUXeOGFF1h//fU55JBDylrudtttx62FXVJVVVU8/PDDNaPFrYnBgwdz2WWXrfH7a1uxYkXZbc8991zmzZvHiy++yIsvvsjtt9++0g8SSWuJ0aOzs8SrqrLnVrCFXa3ZQzsiegFfBf7YHOtbsGAKU6duzuzZZ/DWWxcze/YZTJ26OQsWrPmtOR966CE6dOjAiSeeCEDbtm355S9/ydVXX83ixYuZMGECY8aMYf/996dPnz784Ac/qHnvfffdx/Dhwxk8eDBHHHEEC1dxp7GRI0cyuzBGeu/evWu2UP/yl78wbNgwBg4cyCmnnFITPvfccw+DBw9mwIAB7LPPPgAsWrSIk046iV122YVBgwbVhGix9dZbj/XXXx+AZcuWrTQmeu12F198MW+++SbPP//8KvvqmGOOYdKkSUA2kMIee+xBu3bZlYZz5syhb9++NW3Hjx/P+eefD8AzzzxD//79GT58ON///vdr2j322GMcdNBBAPTr148FCxaQUmKjjTbiT3/6EwDHHXccDzzwAHPmzGHEiBEMHjyYwYMH88QTT9TUsffee/P1r3+dfv36AXDooYcyZMgQdt55Z6644orPfY7Fixdz5ZVX8utf/7qmn3r27MmRRx5Z0+ZHP/oRAwYMYLfddqu5HWtdt2l95JFHGDhwIAMHDmTQoEE14X/JJZewyy670L9/f84777xV9q+kdUtLbGlfCvwAqOP2W42nsrKCmTMPZMWKCqqqslP9q6oWsWJFNr2ycs1uzfnSSy8xZMiQlaZtsMEGbLnlljUBO2PGDCZNmsTMmTOZNGkSc+fO5YMPPuCCCy7ggQceYPr06QwdOpRf/OIX9a7r9ttvrwmWarNmzWLSpEk8/vjjzJgxg7Zt2zJx4kTef/99vvWtb/H3v/+d559/nhtuuAGACy+8kNGjR/PMM8/w8MMP8/3vf3+lG5xUe+utt+jfvz9bbLEFZ599NptttlnJmtq2bcuAAQN45ZVXgGy3ffFWebE+ffrw/vvv89FHH3Hddddx9NFH1/t5q5144olcfvnlTJ06lbZt25Zss8cee/D444/z0ksvsc022/DYY48B8OSTT7LbbruxySabcP/99zN9+nQmTZq00m71p59+mgsvvJCXX34ZgKuvvppp06bx7LPPctlllzF//vyV1jV79my23HJLNthgg5K1LFq0iN12243nn3+ekSNHcuWVVwJ136Z1/Pjx/Pa3v2XGjBk89thjdOzYkfvuu4/XX3+dp59+mhkzZjBt2jQeffTRsvpL0rqhWQdXiYiDgPdSStMiYlQ97cYB4yDbmpk8efJK87t161bWbskPPriWlErv/kxpBW+9dS0bb3x8ueXXWLJkCcuXL/9cDStWrGDx4sUsXbqUkSNH0qZNG5YvX87222/PnDlzmDlzJi+99BLDhw8H4NNPP2XYsGGfW87y5cs566yz+L//+z823nhjLrvsMioqKkgpsXDhQu68806effbZmh8OS5YsoVu3bnTo0IHhw4ez8cYbU1FRQfv27amoqOCee+7hlltuqQmMJUuWMGvWLHbYYYeV1tu9e3cef/xx5s2bxzHHHMP+++/PJptswooVK1i0aNFKdS5fvpwlS5ZQUVFRsyVd6nMsWbKEr371q0yYMIGpU6cyfvz4ms+xcOFCqqqqat63bNkyli1bxltvvcUnn3xCv379qKio4JBDDuG2226joqKCqqoqKisrqaioYOjQoTzwwANsscUWnHjiiVxzzTW8+uqrdOvWjZQSH374IWeddRYzZ86kbdu2zJ49m4qKChYvXsyQIUNq+gmyLdw77shOsXjrrbeYMWMGw4YNq/ksixYtWqnW2tZbbz322msvKioq2GmnnXj44YepqKjg1Vdf5ZxzzuHdd9/l008/Zauttqqp/fTTT+fII4/k4IMPZvPNN+eOO+7g3nvvZcCAAQAsXLiQmTNnfm6c+aVLl37u38TqWLhwYYPer4z92HD24epr7hHR9gAOjogDgQ7ABhHxl5TSN4obpZSuAK6AbOzx2mPTzpo1q6zxp9977y2qqhaXnFdVtZiqqrlrNI71kCFDuPPOO1d67yeffMLbb79N//79eeWVV+jSpUvN/PXXX5+UEh07dmTffffluuuuq3f57du3Z/z48Rxea3SfiKBLly6sv/76jB07lp/97Gcrzb/ttttYb731PveZIoKbb775cyFdl65du9K/f3+ee+45Dj/8cNq2bUvnzp1rlrtixQpmzZrF4MGD6+2/9u3b07FjR0444QQGDx7MCSecQLdu3Wo+R/Vu8uplpJRYf/316dKlCxFRM71z5860adOGrl270qZNG9q1a0fXrl3Zb7/9uPrqq/n3v//NhRdeyN13380999zDqFGj6Nq1Kz//+c/p1asXf/3rX6mqqqJDhw507dqVTp06scEGG9Qsf/LkyTz22GM89dRTdOrUiVGjRtG2bduVPtuAAQOYO3fuSvXW/qzVW+HF9f/whz/ke9/7HgcffDCTJ0/m/PPPp2vXrpx33nmMGTOGu+66iy9/+cs88MADtG/fnnPOOafmHIa6dOjQoUE3jHHM7MZhPzacfbj6mnX3eErpf1JKvVJKvYGjgYdqB3Zj6tixD23alL6Yvk2bznTqtGa35txnn31YvHhxzTHUFStWcOaZZ9acLV2X3Xbbjccff7xmF/rixYt57bXX1mj9N954I++99x4AH374IW+88QbDhw/nkUce4V//+lfNdID99tuPX//61zX35X6uxNi8c+fOZcmSJQB89NFHPP744yVDfvny5fzP//wPW2yxBf379y+r3i233JILL7yQb3/72ytN79mzJ++99x7z589n2bJlNVu6G264IV27duXJJ58E4Prrry+53C222IIPPviA119/nW222YY999yT8ePH19y29OOPP2bTTTelTZs2/PnPf67zpLOPP/6YDTfckE6dOvHKK6/UrLdYp06dOPnkk/nud79bc5XAvHnz+Mtf/lLvZ6/rNq3/+Mc/6NevH2effTZDhw7llVdeqfkRUn2ew9tvv13zdyxJ0Mqv095kk6OIKP0RI9rQo8ea3Zqzesv1hhtuoE+fPmy//fZ06NCBn/70p/W+r0ePHkyYMIFjjjmG/v37s9tuu9UcF14dO+20ExdccAH77rsv/fv35ytf+Qrz5s2jR48eXHHFFYwZM4YBAwZwVOHWo+eeey7Lly+nf//+9O3bl3PPPfdzy5w1axa77rorAwYMYK+99uKss85a6Vj6scceW/P+RYsWrXQyW33HtKudcsopbLvttitNa9++Pf/7v//LrrvuykEHHcSXvvSlmnlXXXUV48aNY/jw4aSU6NatW8nl7rrrrmy//fYAjBgxgrfffps9C3dv+/a3v821117LbrvtxmuvvUbnOkZD2n///amsrKR///6ce+657LbbbiXbXXDBBfTo0YOddtqJvn37cuihh9KjR496P3ddt2m99NJL6du3LwMGDKBjx44ccMAB7Lvvvnz9619n+PDh9OvXj8MPP9yz0yWtpNXfmnPBginMnHkgKVVRVbWINm06E9GGfv3uont3b825tlq4cGHNtc8XXXQR8+bN41e/+pX9iLfmXFvYjw1nH5a2Tt+as3v3PRk+/B3ef38SixfPplOn7ejR4yjatXMwjLXZnXfeyc9+9jMqKyvZaqutmDBhQkuXJEktrtWHNkC7dl3YdFNvzZknRx11VM3ufUlSplUf05YkqTUxtCVJyglDW5KknDC0JUnKCUN7Df373//m6KOPZtttt2WnnXbiwAMPXKOBUqrVvnlGY6m+rebAgQPZcccdS94Mo7biG5NIktYe68TZ4xUVMGkSvP469OkDRx0FDbnUN6XEYYcdxgknnFAzWteMGTN49913awb6WJtMnDiRoUOH8uGHH7LtttsyduxY1ltvvZYuS5K0mlr9lvaUKbD55nDGGXDxxdnz5ptn09fUww8/TPv27Tn11FNrpg0cOJARI0aQUqq5lWS/fv1qbqbx3//939x2220AHHbYYZx00klANvLXj3/8YwAqKys54YQT6N+/P4cffjiLF2fjpj/44IMMGjSIfv36cdJJJ7Fs2TIefPBBDjvssJr133///YwZM6beuhcuXEjnzp1r7ppV321CL7nkEoYNG8awYcNqhl1944032Geffejfvz/77LMPb775JgBjx47l1FNPZcSIEWy//fY1w5FKkhpXqw7tigo48MDsufpOlIsWfTZ9FbeyrtOLL774uVtzVrvpppuYMWMGzz//PA888ADf//73mTdvHnvssUfNrSPffvvtmltCTpkypWas7FdffZVx48bxwgsvsMEGG/C73/2OpUuXMnbs2JrbfFZWVvL73/+e0aNHM2vWLN5//30Arrnmmpr7e9dWPQTpDjvswLnnnkvbtm1XeZvQDTbYgKeffprTTjuNM844A4DTTjuN448/nhdeeIFjjz12pVtdzpkzh0ceeYQ777yTU089laVLl65Z50qS6tSqQ3vSJKiq467dVVXZ/MY2ZcoUjjnmGNq2bUvPnj3Za6+9eOaZZ9h999157LHHePnll9lpp53o2bMn8+bNY+rUqey+++5AdgOMPfbYA4BvfOMbTJkyhVdffZWtt966Zrf7CSecwKOPPkpEcNxxx/GXv/yFBQsWMHXqVA444ICSNU2cOJEXXniBN998k/Hjx/PGG2/w5JNP8vLLL7PHHnswcOBArr32Wt54442a9xxzzDE1z1OnTgVg6tSpfP3rXwfguOOOY0rR7oojjzySNm3a0KdPH7bZZps1GlNdklS/Vn1M+/XXP9vCrm3RIijs9V1tO++8MzfeeGPJeXWN5b7ZZpvx0Ucfcc899zBy5Eg+/PBD/va3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\n",
      "text/plain": [
       "<Figure size 576x576 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig = plt.figure(figsize = (8,8))\n",
    "ax = fig.add_subplot(1,1,1) \n",
    "ax.set_xlabel('Component 1', fontsize = 15) \n",
    "ax.set_ylabel('Component 2', fontsize = 15) \n",
    "ax.set_title('2D Components PCA', fontsize = 20)\n",
    "\n",
    "targets = ['Naruto', 'One Piece 3D: Mugiwara Chase', 'Cowboy Bebop'] \n",
    "colors = ['r', 'y', 'b']\n",
    "for target, color in zip(targets, colors):\n",
    "    indicesToKeep = final_df['title'] == target \n",
    "    ax.scatter(final_df.loc[indicesToKeep, 'Component 1'], final_df.loc[indicesToKeep, 'Component 2'] , c = color, s = 50)\n",
    "ax.legend(targets) \n",
    "ax.grid()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Matrix Factorization - Singular Value Decomposition (SVD)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Followed this tutorial https://towardsdatascience.com/how-did-we-build-book-recommender-systems-in-an-hour-part-2-k-nearest-neighbors-and-matrix-c04b3c2ef55c#:~:text=kNN%20is%20a%20machine%20learning,of%20top%2Dk%20nearest%20neighbors "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Imports and process needed datasets\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "from scipy.sparse import csr_matrix\n",
    "import sklearn\n",
    "from sklearn.decomposition import TruncatedSVD\n",
    "\n",
    "user_rating_data = './datasets/user_score_data.csv'\n",
    "df = pd.read_csv(user_rating_data)\n",
    "user_rating_df = df[['user_id', 'mal_id', 'rating']].copy()\n",
    "\n",
    "anime_info_data = './datasets/anime_data.csv'\n",
    "anime_df = pd.read_csv(anime_info_data)\n",
    "columns = ['aired_from', 'aired_to', 'duration', 'episodes', 'genres', 'popularity', 'premiered', 'rank', 'rating', 'score', 'scored_by', 'source', 'status', 'studios', 'synopsis', 'title', 'type']\n",
    "anime_df = anime_df.drop(columns, axis=1)\n",
    "anime_df = anime_df.dropna()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Combine datasets and group by title to get total rating count for each show"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>title_english</th>\n",
       "      <th>totalRatingCount</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>\"Parade\" de Satie</td>\n",
       "      <td>14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>\"Star\"t</td>\n",
       "      <td>15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-OutsideR:RequieM-</td>\n",
       "      <td>17</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>.Koni-chan</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>.hack//G.U. Trilogy</td>\n",
       "      <td>49</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         title_english  totalRatingCount\n",
       "0    \"Parade\" de Satie                14\n",
       "1              \"Star\"t                15\n",
       "2   -OutsideR:RequieM-                17\n",
       "3           .Koni-chan                 9\n",
       "4  .hack//G.U. Trilogy                49"
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "combine_user_anime = pd.merge(user_rating_df, anime_df, on='mal_id')\n",
    "total_ratings = (combine_user_anime.\n",
    "                    groupby(by = ['title_english'])['rating'].\n",
    "                count().\n",
    "                reset_index().\n",
    "                rename(columns = {'rating' : 'totalRatingCount'})\n",
    "                [['title_english', 'totalRatingCount']]\n",
    "                )\n",
    "total_ratings.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Narrow the dataset down to anime that have been rated a certain number of times (based on the rating stats)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of unique anime to be used:  1710\n"
     ]
    }
   ],
   "source": [
    "userRatings_with_totalRatings = combine_user_anime.merge(total_ratings, left_on='title_english', right_on='title_english')\n",
    "userRatings_with_totalRatings.head(40)\n",
    "\n",
    "popularity_threshold = 100 # this can be changed to narrow the scope of our data\n",
    "ratings_top_anime = userRatings_with_totalRatings.query('totalRatingCount >= @popularity_threshold')\n",
    "n = len(pd.unique(ratings_top_anime['title_english']))\n",
    "print(\"Number of unique anime to be used: \", n)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Convert to 2D Matrix and transpose"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>title_english</th>\n",
       "      <th>.hack//Sign</th>\n",
       "      <th>07-Ghost</th>\n",
       "      <th>11eyes</th>\n",
       "      <th>5 Centimeters Per Second</th>\n",
       "      <th>7 Seeds</th>\n",
       "      <th>91 Days</th>\n",
       "      <th>91 Days: Brief Candle</th>\n",
       "      <th>91 Days: Shoal of Time/All Our Yesterdays/Tomorrow and Tomorrow</th>\n",
       "      <th>A Bridge to the Starry Skies</th>\n",
       "      <th>A Centaur's Life</th>\n",
       "      <th>...</th>\n",
       "      <th>the Garden of sinners Chapter 2: Murder Speculation Part A</th>\n",
       "      <th>the Garden of sinners Chapter 3: Remaining Sense of Pain</th>\n",
       "      <th>the Garden of sinners Chapter 4: The Hollow Shrine</th>\n",
       "      <th>the Garden of sinners Chapter 5: Paradox Paradigm</th>\n",
       "      <th>the Garden of sinners Chapter 6: Oblivion Recording</th>\n",
       "      <th>the Garden of sinners Chapter 7: Murder Speculation Part B</th>\n",
       "      <th>the Garden of sinners Chapter 8: The Final Chapter</th>\n",
       "      <th>the Garden of sinners Remix -Gate of seventh heaven-</th>\n",
       "      <th>tsuritama</th>\n",
       "      <th>xxxHOLiC</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>user_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>9.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 1710 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "title_english  .hack//Sign  07-Ghost  11eyes  5 Centimeters Per Second  \\\n",
       "user_id                                                                  \n",
       "1                      0.0       0.0     0.0                      10.0   \n",
       "2                      0.0       0.0     9.0                       8.0   \n",
       "3                      0.0       0.0     0.0                       7.0   \n",
       "4                      0.0       6.0     0.0                       0.0   \n",
       "5                      0.0       0.0     0.0                       0.0   \n",
       "\n",
       "title_english  7 Seeds  91 Days  91 Days: Brief Candle  \\\n",
       "user_id                                                  \n",
       "1                  0.0      0.0                    0.0   \n",
       "2                  0.0      9.0                    0.0   \n",
       "3                  0.0      8.0                    0.0   \n",
       "4                  0.0      0.0                    0.0   \n",
       "5                  0.0      8.0                    0.0   \n",
       "\n",
       "title_english  91 Days: Shoal of Time/All Our Yesterdays/Tomorrow and Tomorrow  \\\n",
       "user_id                                                                          \n",
       "1                                                            0.0                 \n",
       "2                                                            6.0                 \n",
       "3                                                            0.0                 \n",
       "4                                                            0.0                 \n",
       "5                                                            0.0                 \n",
       "\n",
       "title_english  A Bridge to the Starry Skies  A Centaur's Life  ...  \\\n",
       "user_id                                                        ...   \n",
       "1                                       0.0               0.0  ...   \n",
       "2                                       0.0               0.0  ...   \n",
       "3                                       0.0               0.0  ...   \n",
       "4                                       0.0               0.0  ...   \n",
       "5                                       0.0               0.0  ...   \n",
       "\n",
       "title_english  the Garden of sinners Chapter 2: Murder Speculation Part A  \\\n",
       "user_id                                                                     \n",
       "1                                                            0.0            \n",
       "2                                                            0.0            \n",
       "3                                                            0.0            \n",
       "4                                                            0.0            \n",
       "5                                                            0.0            \n",
       "\n",
       "title_english  the Garden of sinners Chapter 3: Remaining Sense of Pain  \\\n",
       "user_id                                                                   \n",
       "1                                                            0.0          \n",
       "2                                                            0.0          \n",
       "3                                                            0.0          \n",
       "4                                                            0.0          \n",
       "5                                                            0.0          \n",
       "\n",
       "title_english  the Garden of sinners Chapter 4: The Hollow Shrine  \\\n",
       "user_id                                                             \n",
       "1                                                            0.0    \n",
       "2                                                            0.0    \n",
       "3                                                            0.0    \n",
       "4                                                            0.0    \n",
       "5                                                            0.0    \n",
       "\n",
       "title_english  the Garden of sinners Chapter 5: Paradox Paradigm  \\\n",
       "user_id                                                            \n",
       "1                                                            0.0   \n",
       "2                                                            0.0   \n",
       "3                                                            0.0   \n",
       "4                                                            0.0   \n",
       "5                                                            0.0   \n",
       "\n",
       "title_english  the Garden of sinners Chapter 6: Oblivion Recording  \\\n",
       "user_id                                                              \n",
       "1                                                            0.0     \n",
       "2                                                            0.0     \n",
       "3                                                            0.0     \n",
       "4                                                            0.0     \n",
       "5                                                            0.0     \n",
       "\n",
       "title_english  the Garden of sinners Chapter 7: Murder Speculation Part B  \\\n",
       "user_id                                                                     \n",
       "1                                                            0.0            \n",
       "2                                                            0.0            \n",
       "3                                                            0.0            \n",
       "4                                                            0.0            \n",
       "5                                                            0.0            \n",
       "\n",
       "title_english  the Garden of sinners Chapter 8: The Final Chapter  \\\n",
       "user_id                                                             \n",
       "1                                                            0.0    \n",
       "2                                                            0.0    \n",
       "3                                                            0.0    \n",
       "4                                                            0.0    \n",
       "5                                                            0.0    \n",
       "\n",
       "title_english  the Garden of sinners Remix -Gate of seventh heaven-  \\\n",
       "user_id                                                               \n",
       "1                                                            0.0      \n",
       "2                                                            0.0      \n",
       "3                                                            0.0      \n",
       "4                                                            0.0      \n",
       "5                                                            0.0      \n",
       "\n",
       "title_english  tsuritama  xxxHOLiC  \n",
       "user_id                             \n",
       "1                    0.0       0.0  \n",
       "2                    9.0       9.0  \n",
       "3                    0.0       0.0  \n",
       "4                    8.0       0.0  \n",
       "5                    0.0       0.0  \n",
       "\n",
       "[5 rows x 1710 columns]"
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings_top_anime_pivot = ratings_top_anime.pivot_table(index = 'user_id', columns='title_english', values='rating', aggfunc=np.sum).fillna(0)\n",
    "transposed_ratings = ratings_top_anime_pivot.values.T\n",
    "ratings_top_anime_pivot.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Run SVD and calculate Pearson R Correlation Coefficient, (need to figure out num of latent variables for later)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1710, 1710)"
      ]
     },
     "execution_count": 52,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import warnings\n",
    "warnings.filterwarnings(\"ignore\", category = RuntimeWarning)\n",
    "\n",
    "# SVD\n",
    "SVD = TruncatedSVD(n_components=12, random_state=17)\n",
    "matrix = SVD.fit_transform(transposed_ratings)\n",
    "\n",
    "# Correlation Coefficient\n",
    "corr = np.corrcoef(matrix)\n",
    "corr.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Recommendations based on SVD - Random Choice"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Recommendations for:  Pokemon the Movie: Kyurem VS. The Sword of Justice\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "['Bakugan: Gundalian Invaders',\n",
       " 'Bakugan: Mechtanium Surge',\n",
       " 'Bakugan: New Vestroia',\n",
       " 'Beyblade',\n",
       " 'Beyblade G Revolution',\n",
       " 'Beyblade V-Force',\n",
       " 'Beyblade: Metal Masters',\n",
       " 'Digimon Adventure 02',\n",
       " 'Digimon Adventure 02: Revenge of Diaboromon',\n",
       " 'Digimon Adventure tri. Coexistence',\n",
       " 'Digimon Adventure tri. Confession',\n",
       " 'Digimon Adventure tri. Determination',\n",
       " 'Digimon Adventure tri. Future',\n",
       " 'Digimon Adventure tri. Loss',\n",
       " 'Digimon Adventure tri. Reunion',\n",
       " 'Digimon Data Squad',\n",
       " 'Digimon Frontier',\n",
       " 'Digimon Fusion',\n",
       " 'Digimon Tamers',\n",
       " 'Digimon: The Movie',\n",
       " \"Dragon Ball GT: A Hero's Legacy\",\n",
       " 'Dragon Ball Z Special 1: Bardock, The Father of Goku',\n",
       " 'Dragon Ball Z Special 2: The History of Trunks',\n",
       " 'Dragon Ball Z: Bio-Broly',\n",
       " 'Dragon Ball Z: Bojack Unbound',\n",
       " 'Dragon Ball Z: Broly – Second Coming',\n",
       " 'Dragon Ball Z: Broly – The Legendary Super Saiyan',\n",
       " \"Dragon Ball Z: Cooler's Revenge\",\n",
       " 'Dragon Ball Z: Fusion Reborn',\n",
       " 'Dragon Ball Z: Lord Slug',\n",
       " 'Dragon Ball Z: Super Android 13!',\n",
       " 'Dragon Ball Z: The Return of Cooler',\n",
       " 'Dragon Ball Z: The Tree of Might',\n",
       " \"Dragon Ball Z: The World's Strongest\",\n",
       " 'Dragon Ball Z: Wrath of the Dragon',\n",
       " 'Metal Fight Beyblade',\n",
       " 'Pokemon 3: The Movie',\n",
       " 'Pokemon 4Ever',\n",
       " 'Pokemon Heroes',\n",
       " 'Pokemon the Movie: Black - Victini and Reshiram',\n",
       " 'Pokemon the Movie: Diancie and the Cocoon of Destruction',\n",
       " 'Pokemon the Movie: Genesect and the Legend Awakened',\n",
       " 'Pokemon the Movie: Hoopa and the Clash of Ages',\n",
       " 'Pokemon the Movie: Kyurem VS. The Sword of Justice',\n",
       " 'Pokemon the Movie: White - Victini and Zekrom',\n",
       " 'Pokemon: Advanced',\n",
       " 'Pokemon: Arceus and the Jewel of Life',\n",
       " 'Pokemon: Destiny Deoxys',\n",
       " 'Pokemon: Giratina and the Sky Warrior',\n",
       " 'Pokemon: Jirachi Wishmaker',\n",
       " 'Pokemon: Lucario and the Mystery of Mew',\n",
       " 'Pokemon: Mewtwo Returns',\n",
       " 'Pokemon: Pikachu and Pichu',\n",
       " \"Pokemon: Pikachu's Summer Vacation\",\n",
       " 'Pokemon: Pokemon Ranger and the Temple of the Sea',\n",
       " 'Pokemon: The First Movie',\n",
       " 'Pokemon: The Movie 2000',\n",
       " 'Pokemon: The Rise Of Darkrai',\n",
       " 'Pokemon: Zoroark: Master of Illusions',\n",
       " 'Pokémon Generations',\n",
       " 'Pokémon The Series: XY',\n",
       " 'Pokémon the Movie: I Choose You!',\n",
       " 'Pokémon the Series: XYZ',\n",
       " 'Pokémon: Black & White',\n",
       " 'Pokémon: Black & White: Adventures in Unova',\n",
       " 'Pokémon: Black & White: Adventures in Unova and Beyond',\n",
       " 'Pokémon: Black & White: Rival Destinies',\n",
       " 'Pokémon: Origins',\n",
       " 'Sonic X',\n",
       " 'Yu-Gi-Oh! 3D: Bonds Beyond Time',\n",
       " \"Yu-Gi-Oh! 5D's\",\n",
       " 'Yu-Gi-Oh! GX',\n",
       " 'Yu-Gi-Oh! Zexal',\n",
       " 'Yu-Gi-Oh!: The Movie']"
      ]
     },
     "execution_count": 53,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "anime_titles = ratings_top_anime_pivot.columns\n",
    "anime_titles_list = list(anime_titles)\n",
    "\n",
    "# Pick random anime\n",
    "title_chosen = np.random.choice(anime_titles_list)\n",
    "print('Recommendations for: ', title_chosen)  \n",
    "\n",
    "# Get its index and correlation coefficient\n",
    "title_index = anime_titles_list.index(title_chosen)\n",
    "corr_title = corr[title_index]\n",
    "\n",
    "# List the correlated titles with the random title chosen   \n",
    "list(anime_titles[(corr_title<1.0) & (corr_title>0.9)])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Recommendations based on SVD - Input Title"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Recommendations for:  Snow White with the Red Hair \n",
      "\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "['A Lull in the Sea',\n",
       " 'Anonymous Noise',\n",
       " 'Aoharu x Machinegun',\n",
       " 'Beyond the Boundary',\n",
       " 'Blue Spring Ride',\n",
       " \"I've Always Liked You\",\n",
       " 'Kiss Him, Not Me!',\n",
       " 'Kiznaiver',\n",
       " 'Maid Sama!',\n",
       " \"Monthly Girls' Nozaki-kun\",\n",
       " 'My Little Monster',\n",
       " 'My Love Story!!',\n",
       " 'Orange',\n",
       " 'Prince of Stride: Alternative',\n",
       " 'Rainbow Days',\n",
       " 'ReLIFE',\n",
       " 'Say \"I Love You\".',\n",
       " 'Snow White with the Red Hair 2',\n",
       " 'The Anthem of the Heart',\n",
       " 'The Lost Village',\n",
       " 'The World is Still Beautiful',\n",
       " 'Welcome to the Ballroom',\n",
       " 'Wolf Girl & Black Prince',\n",
       " 'Yona of the Dawn']"
      ]
     },
     "execution_count": 54,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Type in title\n",
    "title_chosen = \"Snow White with the Red Hair\"\n",
    "print('Recommendations for: ', title_chosen, '\\n')  \n",
    "\n",
    "# Get its index and correlation coefficient\n",
    "title_index = anime_titles_list.index(title_chosen)\n",
    "corr_title = corr[title_index]\n",
    "\n",
    "# List the correlated titles with the random title chosen   \n",
    "list(anime_titles[(corr_title<1.0) & (corr_title>0.9)])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**FAY'S TO DO: figure out the right latent variable number, see if we can rank the recommendations list and keep it to 10 recs, see if I can check for accuracy and comparisons for analysis**"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
